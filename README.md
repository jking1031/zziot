# 工单系统使用说明

## 系统概述

工单系统是为工作环境设计的问题报告和任务管理工具，用于高效处理各种工作请求、设备故障报告和其他需求。系统采用分级审核和分配机制，确保每个问题都能得到适当的处理。

## 关键功能

- **多角色工单创建**: 所有角色都可以创建工单，报告问题或提交需求
- **管理员审核机制**: 所有工单由管理员审核后分配给相关角色处理
- **工单生命周期管理**: 从创建、审核、分配到处理和关闭的完整流程
- **评论与沟通**: 在工单内添加评论，便于各方沟通和信息更新
- **状态追踪**: 实时追踪工单处理进度和当前状态
- **分类与优先级**: 支持工单分类和优先级设置，便于资源分配

## 工单流程

1. **创建工单**: 用户创建工单，填写标题、描述、分类和优先级
2. **管理员审核**: 管理员审核工单，可批准或拒绝
3. **分配工单**: 审核通过后，管理员将工单分配给相关角色处理
4. **工单处理**: 处理人处理工单，可更新进度
5. **完成确认**: 处理人完成工单处理后标记为已完成
6. **关闭工单**: 管理员确认处理结果后关闭工单

## 角色与权限

- **普通用户**: 创建工单、查看自己创建的工单、添加评论
- **处理人员**: 查看分配给自己角色的工单、更新工单状态、添加评论
- **管理员**: 审核工单、分配工单、管理所有工单、查看统计数据

## 使用指南

1. 从首页"工单系统"入口或快捷方式进入
2. 查看自己创建的工单或分配给自己的工单
3. 点击"创建工单"按钮报告新问题
4. 点击任意工单查看详情和添加评论
5. 管理员可使用"工单管理"功能进行批量处理

## 后端API集成

工单系统通过以下API端点与Node-RED后端集成：

- `GET /api/tickets` - 获取工单列表
- `GET /api/tickets/:id` - 获取工单详情
- `POST /api/tickets` - 创建新工单
- `PATCH /api/tickets/:id/status` - 更新工单状态
- `POST /api/tickets/:id/comments` - 添加工单评论
- `PATCH /api/tickets/:id/assign` - 分配工单

## 数据模型

工单数据模型包含以下关键字段：

- **id**: 工单唯一标识符
- **title**: 工单标题
- **description**: 工单详细描述
- **status**: 工单状态（待审核、已审核、已分配、处理中、已完成、已拒绝、已关闭）
- **priority**: 优先级（低、中、高、紧急）
- **category**: 工单类别
- **creator**: 创建者信息
- **assignedTo**: 处理人信息
- **createdAt**: 创建时间
- **updatedAt**: 更新时间
- **dueDate**: 截止日期
- **timeline**: 工单处理时间线记录

## 设计原则

工单系统的设计遵循以下原则：

1. **简单易用**: 界面直观，操作简单，降低使用门槛
2. **流程清晰**: 明确的工单生命周期和处理流程
3. **权限分明**: 基于角色的权限控制，确保数据安全
4. **实时反馈**: 工单状态变更即时通知相关人员
5. **可追溯性**: 完整记录工单处理过程和操作历史 




工单流程

1. **工单创建**:
   - 任何角色（1-9）都可以创建工单
   - 创建后工单状态为"待审核"(pending)

2. **工单审核**:
   - 管理员(1)和部门管理员(2)负责审核工单
   - 审核后工单状态变为"已审核"(approved)或"已拒绝"(rejected)

3. **工单分配**:
   - 管理员(1)和部门管理员(2)将已审核的工单分配给相应的角色(3-9)
   - 分配后工单状态变为"已分配"(assigned)

4. **工单处理**:
   - 被分配的角色(3-9)处理工单
   - 处理开始时工单状态变为"处理中"(inProgress)
   - 处理完成后工单状态变为"已完成"(completed)

5. **工单完成审核**:
   - 管理员(1)和部门管理员(2)审核已完成的工单
   - 审核通过后工单状态变为"已关闭"(closed)
   - 同时抄送给工单创建者
